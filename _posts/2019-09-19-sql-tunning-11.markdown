---
layout: post
title:  "4.1 NL조인"
date:   2019-09-19
categories: SQL튜닝
---  
조인의 기본은 NL조인.  
---  
## 4.1.1 기본 메커니즘
---  
일반적으로 NL조인은 Outer와 Inner 양쪽 테이블 모두 인덱스를 이용한다.  
NL조인은 '인덱스를 이용한 조인방식'
예제 책 참고..  
---  
## 4.1.2 NL 조인 실행계획 제어 
---  
```sql
select 	/*+ ordered use_nl(c) */
		e.사원명, c.고객명, c.전화번호
from	사원 e, 고객 c	
where	e.입사일자 >= '19960101'
and		c.관리사원번호 = e.사원번호	
```
ordered 힌트는 FROM절에 기술한 순서대로 조인하라고 옵티마이저에 지시할 때 사용한다.  
use_nl 힌트는 NL 방식으로 조인하라고 지시할 때 사용한다.  
해석하면 사원테이블 기준으로 고객 테이블과 NL방식으로 조인하라는 뜻이다.  
ordered 대신 leading 힌트를 사용해도 됨.  
---  
## 4.1.3 NL 조인 수행 과정 분석  
---  
NL조인은 각 단계를 모두 완료하고 다음 단계로 넘어가는게 아니라 한 레코드씩 순차적으로 진행한다.  
책 그림 4-7 참고..  
---  
## 4.1.4 NL 조인 튜닝 포인트  
---  
온라인 트랜잭션 처리(OLTP) 시스템에서 튜닝할 때는 일차적으로 NL조인부터 고려하는것이 올바른 순서!  
여러 방안을 검토한 결과 NL조인으로 결코 좋은 성능을 내기 어렵다고 판단될 때, 소트 머지 조인이나 해시 조인을 검토한다.  
---  
## 4.1.5 NL 조인 특징 요약  
---  
첫번째 특징 : 랜덤 액세스 위조의 조인 방식. 랜덤 액세스 방식이기 때문에 대량 데이터 조인할 때 NL 조인이 불리하다.   
두번째 특징 : 한 레코드씩 순차적으로 진행한다는 점. 부분범위 처리가 가능한 상황에서 매우 빠른 응답속도를 낼 수 있다.  순차적으로 진행하므로 먼저 액세스되는 테이블 처리 범위에 의해 전체 일량이 결정되는 특징이 있다.  
<br>
마지막으로 다른 조인 방식과 비교할 때 NL조인은 인덱스 구성 전략이 특히 중요함. 결론적으로 NL조인은 소량 데이터를 처리하거나 부분범위 처리가 가능한 온라인 트랜잭션 처리(OLTP) 시스템에 적합한 조인 방식   
---
## 4.1.6 NL 조인 튜닝 실습  
---  
실습예제는 필요할 때 책 참고..  
---  
## 4.1.7 NL 조인 확장 메커니즘  
---  
오라클은 NL 조인 성능을 높이기 위해 테이블 Prefetch, 배치 I/O 기능을 도입했음.  
'테이블 Prefetch'는 인덱스를 이용해 테이블을 액세스하다가 디스크 I/O가 필요해지면, 이어서 곧 읽게 될 블록까지 미리 읽어서 버퍼캐시에 저장하는 기능.  
'배치 I/O'는 디스크 I/O Call을 미뤘다가 읽을 블록이 일정량 쌓이면 한꺼번에 처리하는 기능.  
두 기능 모두 읽는 블록마다 건건이 I/O Call을 발생시키는 비효율을 줄이기 위해 고안되었음.  
나머지 실행계획 예제는 책 참고..  
<br>
<br>
<br>
<br>
![img01]({{ site.baseurl }}/images/post/sqlTuning/book/bookCover.PNG)<br>
<br>
본 포스팅은 친절한 SQL 튜닝 온라인 스터디를 진행하면서 공부한 내용을 바탕으로 작성하였습니다.<br>
<br>
<br>
<br>