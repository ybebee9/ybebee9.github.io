---
layout: post
title:  "1.2 SQL 공유 및 재사용"
date:   2019-08-12
categories: Database
---  
<br>
  
## 1.2.1 소프트 파싱 vs 하드 파싱
SQL파싱, 최적화, 로우 소스 생성 과정을 거쳐 생성한 내부 프로시저를 반복 재사용할 수 있도록 캐싱해두는 메모리 공간을 '**라이브러리 캐시(Library Cache)**'라고 한다.  
라이브러리 캐시는 SGA 구성요소다. SGA(System Global Area)는 서버 프로세스와 백그라운드 프로세스가 공통으로 액세스하는 데이터와 제어구조를 캐싱하는 메모리 공간이다.
  

사용자가 SQL문을 전달하면 DBMS는 SQL을 파싱한 후 해당 SQL이 라이브러리 캐시에 존재하는지부터 확인한다.  
캐시에서 찾으면 곧바로 실행단계로 넘어가지만, 찾지못하면 최적화 단계를 거친다. 
  

**소프트 파싱(Soft Parsing)** : SQL을 캐시에서 찾아 곧바로 실행단계로 넘어가는 것
  
**하드 파싱(Hard Parsing)** : SQL을 캐시에서 찾는데 실패하여 최적화 및 로우 소스 생성 단계까지 모두 거치는 것
  

> SQL 최적화 과정은 왜 하드(Hard)한가?
> 옵티마이저가 SQL을 최적화할 때 많은 일을 수행한다. 
> SQL 옵티마이저는 순식간에 엄청나게 많은 연산을 한다.  
> * 테이블, 컬럼, 인덱스 구조에 관한 기본정보
> * 오브젝트 통계 : 테이블 통계, 인덱스 통계, (히스토그램을 포함한)컬럼 통계
> * 시스템 통계 : CPU 속도, Single Block I/O 속도, Multiblock I/O 속도 등
> * 옵티마이저 관련 파라미터 
  
  

하나의 쿼리를 수행하는데 있어 후보군이 될만한 무수히 많은 실행경로를 도출하고,  
짧은 순간에 딕셔너리와 통계정보를 읽어 각각에 대한 효율성을 판단하는 과정은 결코 가벼울(soft)수 없다.  
데이터베이스에서 이루어지는 처리과정은 대부분 I/O 작업에 집중되는 반면, 하드파싱은 CPU를 많이 소비하는 몇 안 되는 작업 중 하나다.  
이렇게 어려운(=hard)작업을 거쳐 생성한 내부 프로시저를 한번만 사용하고 버린다면 굉장히 비효율적이다.  
라이브러리 캐시가 필요한 이유가 바로 여기에 있다.  